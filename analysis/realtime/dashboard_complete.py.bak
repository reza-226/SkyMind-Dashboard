# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# dashboard_complete.py - Ù†Ø³Ø®Ù‡ Ù†Ù‡Ø§ÛŒÛŒ Ø¨Ø§ UI Ø¨Ù‡Ø¨ÙˆØ¯ ÛŒØ§ÙØªÙ‡
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

import dash
from dash import dcc, html, dash_table, Input, Output, State
from dash.exceptions import PreventUpdate
import plotly.graph_objs as go
import numpy as np
import pandas as pd
import os
from collections import deque

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø§ÙˆÙ„ÛŒÙ‡
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
RESULTS_DIR = 'results'
MAX_DATA_POINTS = 30

os.makedirs(RESULTS_DIR, exist_ok=True)

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ØªÙˆÙ„ÛŒØ¯ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ù†Ù…ÙˆÙ†Ù‡
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
def generate_sample_data():
    """ØªÙˆÙ„ÛŒØ¯ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ø´Ø¯Ù‡"""
    n_episodes = 500
    episodes = list(range(1, n_episodes + 1))
    
    rewards = []
    utilities = []
    energies = []
    
    for i in range(n_episodes):
        base_reward = -100 + (i / n_episodes) * 150
        reward = base_reward + np.random.normal(0, 10)
        rewards.append(reward)
        
        base_utility = 0.3 + (i / n_episodes) * 0.6
        utility = np.clip(base_utility + np.random.normal(0, 0.05), 0, 1)
        utilities.append(utility)
        
        base_energy = 80 - (i / n_episodes) * 40
        energy = np.clip(base_energy + np.random.normal(0, 5), 10, 100)
        energies.append(energy)
    
    return {
        'episodes': episodes,
        'rewards': rewards,
        'utilities': utilities,
        'energies': energies
    }

sample_data = generate_sample_data()
np.save(os.path.join(RESULTS_DIR, 'sample_training_results.npy'), sample_data)

live_data_store = {
    'episodes': deque(maxlen=30),
    'utility': deque(maxlen=30),
    'energy': deque(maxlen=30)
}

episode_counter = 0

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# Ø§ÛŒØ¬Ø§Ø¯ Ø¨Ø±Ù†Ø§Ù…Ù‡ Dash
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
app = dash.Dash(__name__)
app.title = "Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ SkyMind"
app.config.suppress_callback_exceptions = True

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# Ø§Ø³ØªØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø³ÙØ§Ø±Ø´ÛŒ (ØªÙ… ØªÛŒØ±Ù‡ + ÙÙˆÙ†Øª ÙØ§Ø±Ø³ÛŒ)
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
CARD_STYLE = {
    'backgroundColor': '#1e2a38',
    'padding': '25px',
    'borderRadius': '12px',
    'marginBottom': '20px',
    'boxShadow': '0 4px 15px rgba(0,0,0,0.3)',
    'border': '1px solid #2d3e50'
}

HEADER_STYLE = {
    'color': '#00d4ff',
    'marginBottom': '15px',
    'fontFamily': 'Vazir, Tahoma, sans-serif',
    'fontWeight': 'bold'
}

TEXT_STYLE = {
    'color': '#e0e0e0',
    'fontSize': '15px',
    'lineHeight': '1.8',
    'fontFamily': 'Vazir, Tahoma, sans-serif'
}

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# Layout Ø§ØµÙ„ÛŒ
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
app.layout = html.Div([
    # ÙÙˆÙ†Øª ÙØ§Ø±Ø³ÛŒ
    html.Link(
        rel='stylesheet',
        href='https://cdn.jsdelivr.net/gh/rastikerdar/vazir-font@v30.1.0/dist/font-face.css'
    ),
    
    # Ù‡Ø¯Ø±
    html.Div([
        html.H1("ğŸ›¸ Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ SkyMind", 
                style={'textAlign': 'center', 'color': '#00d4ff', 'marginBottom': '10px',
                       'fontFamily': 'Vazir, sans-serif', 'fontSize': '42px'}),
        html.P("Ù…Ø§Ù†ÛŒØªÙˆØ±ÛŒÙ†Ú¯ Ù„Ø­Ø¸Ù‡â€ŒØ§ÛŒ Ùˆ Ù†ØªØ§ÛŒØ¬ Ø¢Ù…ÙˆØ²Ø´", 
               style={'textAlign': 'center', 'color': '#a0a0a0', 'fontSize': '18px',
                      'fontFamily': 'Vazir, sans-serif'})
    ], style={'padding': '30px', 'backgroundColor': '#0d1b2a', 'borderBottom': '3px solid #00d4ff'}),
    
    # Tabs
    dcc.Tabs(id='tabs', value='tab-overview', children=[
        dcc.Tab(label='ğŸ“Š Ù†Ù…Ø§ÛŒ Ú©Ù„ÛŒ', value='tab-overview',
                style={'backgroundColor': '#1e2a38', 'color': '#e0e0e0', 'fontFamily': 'Vazir'},
                selected_style={'backgroundColor': '#00d4ff', 'color': '#0d1b2a', 'fontWeight': 'bold'}),
        dcc.Tab(label='ğŸ¤– Ø¬Ø²Ø¦ÛŒØ§Øª Ø¹Ø§Ù…Ù„â€ŒÙ‡Ø§', value='tab-agents',
                style={'backgroundColor': '#1e2a38', 'color': '#e0e0e0', 'fontFamily': 'Vazir'},
                selected_style={'backgroundColor': '#00d4ff', 'color': '#0d1b2a', 'fontWeight': 'bold'}),
        dcc.Tab(label='âš™ï¸ Ù¾Ø§Ø±Ø§Ù…ØªØ±Ù‡Ø§ÛŒ Ø¢Ù…ÙˆØ²Ø´', value='tab-hyperparams',
                style={'backgroundColor': '#1e2a38', 'color': '#e0e0e0', 'fontFamily': 'Vazir'},
                selected_style={'backgroundColor': '#00d4ff', 'color': '#0d1b2a', 'fontWeight': 'bold'}),
        dcc.Tab(label='ğŸ“ˆ Ù†ØªØ§ÛŒØ¬ Ø¢Ù…ÙˆØ²Ø´', value='tab-results',
                style={'backgroundColor': '#1e2a38', 'color': '#e0e0e0', 'fontFamily': 'Vazir'},
                selected_style={'backgroundColor': '#00d4ff', 'color': '#0d1b2a', 'fontWeight': 'bold'}),
        dcc.Tab(label='ğŸ”´ Ù…Ø§Ù†ÛŒØªÙˆØ±ÛŒÙ†Ú¯ Ø²Ù†Ø¯Ù‡', value='tab-live',
                style={'backgroundColor': '#1e2a38', 'color': '#e0e0e0', 'fontFamily': 'Vazir'},
                selected_style={'backgroundColor': '#00d4ff', 'color': '#0d1b2a', 'fontWeight': 'bold'})
    ], style={'fontFamily': 'Vazir'}),
    
    html.Div(id='tabs-content', style={'padding': '25px', 'backgroundColor': '#0d1b2a', 'minHeight': '100vh'})
], style={'backgroundColor': '#0d1b2a', 'fontFamily': 'Vazir'})

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# Callback Ø¨Ø±Ø§ÛŒ ØªØºÛŒÛŒØ± Ù…Ø­ØªÙˆØ§ÛŒ ØªØ¨â€ŒÙ‡Ø§
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
@app.callback(
    Output('tabs-content', 'children'),
    Input('tabs', 'value')
)
def render_content(tab):
    """ØªØºÛŒÛŒØ± Ù…Ø­ØªÙˆØ§ÛŒ ØªØ¨â€ŒÙ‡Ø§"""
    if tab == 'tab-overview':
        return html.Div([
            html.H3("ğŸ“Š Ù†Ù…Ø§ÛŒ Ú©Ù„ÛŒ Ø³ÛŒØ³ØªÙ…", style=HEADER_STYLE),
            
            html.Div([
                html.Div([
                    html.H4("ğŸ¯ Ù‡Ø¯Ù Ù¾Ø±ÙˆÚ˜Ù‡", style={'color': '#00ff88', 'fontFamily': 'Vazir'}),
                    html.P("Ø§Ù„Ú¯ÙˆØ±ÛŒØªÙ… MADDPG (Multi-Agent Deep Deterministic Policy Gradient) Ø¨Ø±Ø§ÛŒ Ø¨Ù‡ÛŒÙ†Ù‡â€ŒØ³Ø§Ø²ÛŒ "
                           "Ø¨Ø±ÙˆÙ†â€ŒØ³Ù¾Ø§Ø±ÛŒ Ù…Ø­Ø§Ø³Ø¨Ø§Øª Ø¨Ø§ Ú©Ù…Ú© Ù¾Ù‡Ù¾Ø§Ø¯Ù‡Ø§ (UAV-assisted Computation Offloading)", 
                           style=TEXT_STYLE),
                    html.Hr(style={'borderColor': '#2d3e50'}),
                    html.P("ğŸ”¹ Ø¢Ù…ÙˆØ²Ø´ Ú†Ù†Ø¯ Ø¹Ø§Ù…Ù„ Ù‡ÙˆØ´Ù…Ù†Ø¯ Ø¨Ø±Ø§ÛŒ ØªØµÙ…ÛŒÙ…â€ŒÚ¯ÛŒØ±ÛŒ Ù‡Ù…Ø²Ù…Ø§Ù†", style=TEXT_STYLE),
                    html.P("ğŸ”¹ Ø¨Ù‡ÛŒÙ†Ù‡â€ŒØ³Ø§Ø²ÛŒ Ù…ØµØ±Ù Ø§Ù†Ø±Ú˜ÛŒ Ùˆ ØªØ§Ø®ÛŒØ± Ø´Ø¨Ú©Ù‡", style=TEXT_STYLE),
                    html.P("ğŸ”¹ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ø´Ø¨Ú©Ù‡â€ŒÙ‡Ø§ÛŒ Actor-Critic", style=TEXT_STYLE)
                ], style=CARD_STYLE),
                
                html.Div([
                    html.H4("ğŸ“Š Ø¢Ù…Ø§Ø± Ø³Ø±ÛŒØ¹ Ø³ÛŒØ³ØªÙ…", style={'color': '#ff9500', 'fontFamily': 'Vazir'}),
                    html.P(f"ğŸ“ Ù…Ø³ÛŒØ± Ø°Ø®ÛŒØ±Ù‡ Ù†ØªØ§ÛŒØ¬: {RESULTS_DIR}", style=TEXT_STYLE),
                    html.P(f"ğŸ“¦ ØªØ¹Ø¯Ø§Ø¯ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù…ÙˆØ¬ÙˆØ¯: {len([f for f in os.listdir(RESULTS_DIR) if f.endswith('.npy')])}", 
                           style=TEXT_STYLE),
                    html.P(f"ğŸ”¢ Ø­Ø¯Ø§Ú©Ø«Ø± Ù†Ù‚Ø§Ø· Ø¯Ø§Ø¯Ù‡: {MAX_DATA_POINTS}", style=TEXT_STYLE),
                    html.P(f"â± Ù¾Ù†Ø¬Ø±Ù‡ Ù†Ù…Ø§ÛŒØ´ Ø²Ù†Ø¯Ù‡: 30 Ù‚Ø¯Ù…", style=TEXT_STYLE)
                ], style=CARD_STYLE),
                
                html.Div([
                    html.H4("ğŸ›  ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯", style={'color': '#00d4ff', 'fontFamily': 'Vazir'}),
                    html.P("âœ… Ù†Ù…Ø§ÛŒØ´ Ù„Ø­Ø¸Ù‡â€ŒØ§ÛŒ Ø¹Ù…Ù„Ú©Ø±Ø¯ Ø³ÛŒØ³ØªÙ…", style=TEXT_STYLE),
                    html.P("âœ… ØªØ­Ù„ÛŒÙ„ Ù†ØªØ§ÛŒØ¬ Ø¢Ù…ÙˆØ²Ø´ Ø¨Ø§ Ù†Ù…ÙˆØ¯Ø§Ø±Ù‡Ø§ÛŒ ØªØ¹Ø§Ù…Ù„ÛŒ", style=TEXT_STYLE),
                    html.P("âœ… Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ù…Ø¹Ù…Ø§Ø±ÛŒ Ø´Ø¨Ú©Ù‡â€ŒÙ‡Ø§ÛŒ Ø¹ØµØ¨ÛŒ", style=TEXT_STYLE),
                    html.P("âœ… Ø¯Ú©Ù…Ù‡ Pause/Resume Ø¨Ø±Ø§ÛŒ Ú©Ù†ØªØ±Ù„ Ù…Ø§Ù†ÛŒØªÙˆØ±ÛŒÙ†Ú¯", style=TEXT_STYLE)
                ], style=CARD_STYLE)
            ])
        ])
    
    elif tab == 'tab-agents':
        return html.Div([
            html.H3("ğŸ¤– Ù…Ø¹Ù…Ø§Ø±ÛŒ Ø¹Ø§Ù…Ù„â€ŒÙ‡Ø§ÛŒ Ù‡ÙˆØ´Ù…Ù†Ø¯", style=HEADER_STYLE),
            
            html.Div([
                html.H4("Ø¹Ø§Ù…Ù„ 0: Ú©Ù†ØªØ±Ù„â€ŒÚ©Ù†Ù†Ø¯Ù‡ Ù¾Ù‡Ù¾Ø§Ø¯ (UAV Controller)", 
                        style={'color': '#00ff88', 'fontFamily': 'Vazir', 'marginBottom': '15px'}),
                html.P("Ø§ÛŒÙ† Ø¹Ø§Ù…Ù„ Ù…Ø³Ø¦ÙˆÙ„ ØªØµÙ…ÛŒÙ…â€ŒÚ¯ÛŒØ±ÛŒ Ø¯Ø±Ø¨Ø§Ø±Ù‡ Ø­Ø±Ú©Øª Ù¾Ù‡Ù¾Ø§Ø¯ Ùˆ ØªØ®ØµÛŒØµ Ù…Ù†Ø§Ø¨Ø¹ Ù…Ø­Ø§Ø³Ø¨Ø§ØªÛŒ Ø§Ø³Øª.", 
                       style=TEXT_STYLE),
                html.Hr(style={'borderColor': '#2d3e50', 'margin': '15px 0'}),
                html.P("ğŸ”¸ Ø´Ø¨Ú©Ù‡ Actor:", style={'color': '#00d4ff', 'fontWeight': 'bold', 'fontFamily': 'Vazir'}),
                html.P("ÙˆØ±ÙˆØ¯ÛŒ [obs_dim] â†’ Ù„Ø§ÛŒÙ‡ Ù¾Ù†Ù‡Ø§Ù† 128 Ù†ÙˆØ±ÙˆÙ† â†’ Ù„Ø§ÛŒÙ‡ Ù¾Ù†Ù‡Ø§Ù† 64 Ù†ÙˆØ±ÙˆÙ† â†’ Ø®Ø±ÙˆØ¬ÛŒ [action_dim]", 
                       style={**TEXT_STYLE, 'marginLeft': '20px'}),
                html.P("ØªØ§Ø¨Ø¹ ÙØ¹Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ: ReLU Ø¯Ø± Ù„Ø§ÛŒÙ‡â€ŒÙ‡Ø§ÛŒ Ù…ÛŒØ§Ù†ÛŒØŒ Tanh Ø¯Ø± Ø®Ø±ÙˆØ¬ÛŒ", 
                       style={**TEXT_STYLE, 'marginLeft': '20px', 'color': '#a0a0a0'}),
                html.P("ğŸ”¸ Ø´Ø¨Ú©Ù‡ Critic:", style={'color': '#ff9500', 'fontWeight': 'bold', 'fontFamily': 'Vazir', 'marginTop': '10px'}),
                html.P("ÙˆØ±ÙˆØ¯ÛŒ [(obs+act) Ã— n_agents] â†’ 128 Ù†ÙˆØ±ÙˆÙ† â†’ 64 Ù†ÙˆØ±ÙˆÙ† â†’ Ø®Ø±ÙˆØ¬ÛŒ Q-value (1)", 
                       style={**TEXT_STYLE, 'marginLeft': '20px'}),
                html.P("Ù†Ù‚Ø´: Ø§Ø±Ø²ÛŒØ§Ø¨ÛŒ Ú©ÛŒÙÛŒØª Ø§Ù‚Ø¯Ø§Ù…Ø§Øª Ú¯Ø±ÙØªÙ‡ Ø´Ø¯Ù‡ ØªÙˆØ³Ø· ØªÙ…Ø§Ù… Ø¹Ø§Ù…Ù„â€ŒÙ‡Ø§", 
                       style={**TEXT_STYLE, 'marginLeft': '20px', 'color': '#a0a0a0'})
            ], style=CARD_STYLE),
            
            html.Div([
                html.H4("Ø¹Ø§Ù…Ù„ 1: Ù…Ø¯ÛŒØ±ÛŒØª Ø³Ø±ÙˆØ± Ù„Ø¨Ù‡ (Edge Server Manager)", 
                        style={'color': '#00ff88', 'fontFamily': 'Vazir', 'marginBottom': '15px'}),
                html.P("Ø§ÛŒÙ† Ø¹Ø§Ù…Ù„ ØªØµÙ…ÛŒÙ… Ù…ÛŒâ€ŒÚ¯ÛŒØ±Ø¯ Ú©Ù‡ Ú©Ø¯Ø§Ù… Ù…Ø­Ø§Ø³Ø¨Ø§Øª Ø±Ø§ Ø¨Ø§ÛŒØ¯ Ø¨Ø± Ø±ÙˆÛŒ Ø³Ø±ÙˆØ± Ù„Ø¨Ù‡ Ø§Ù†Ø¬Ø§Ù… Ø¯Ù‡Ø¯.", 
                       style=TEXT_STYLE),
                html.Hr(style={'borderColor': '#2d3e50', 'margin': '15px 0'}),
                html.P("ğŸ”¸ Ø´Ø¨Ú©Ù‡ Actor:", style={'color': '#00d4ff', 'fontWeight': 'bold', 'fontFamily': 'Vazir'}),
                html.P("ÙˆØ±ÙˆØ¯ÛŒ [obs_dim] â†’ 128 Ù†ÙˆØ±ÙˆÙ† â†’ 64 Ù†ÙˆØ±ÙˆÙ† â†’ [action_dim]", 
                       style={**TEXT_STYLE, 'marginLeft': '20px'}),
                html.P("ğŸ”¸ Ø´Ø¨Ú©Ù‡ Critic:", style={'color': '#ff9500', 'fontWeight': 'bold', 'fontFamily': 'Vazir', 'marginTop': '10px'}),
                html.P("ÙˆØ±ÙˆØ¯ÛŒ [(obs+act) Ã— n_agents] â†’ 128 Ù†ÙˆØ±ÙˆÙ† â†’ 64 Ù†ÙˆØ±ÙˆÙ† â†’ Q-value", 
                       style={**TEXT_STYLE, 'marginLeft': '20px'}),
                html.P("ğŸ’¡ Ù†Ú©ØªÙ‡: Ù‡Ø± Ø¯Ùˆ Ø¹Ø§Ù…Ù„ Ø¨Ù‡ ØµÙˆØ±Øª Ù‡Ù…Ø²Ù…Ø§Ù† ÛŒØ§Ø¯ Ù…ÛŒâ€ŒÚ¯ÛŒØ±Ù†Ø¯ Ùˆ ØªØµÙ…ÛŒÙ…Ø§Øª Ù‡Ù…â€ŒØ§ÙØ²Ø§ Ù…ÛŒâ€ŒÚ¯ÛŒØ±Ù†Ø¯", 
                       style={**TEXT_STYLE, 'marginTop': '15px', 'color': '#ffd700', 'fontWeight': 'bold'})
            ], style=CARD_STYLE)
        ])
    
    elif tab == 'tab-hyperparams':
        return html.Div([
            html.H3("âš™ï¸ Ù¾Ø§Ø±Ø§Ù…ØªØ±Ù‡Ø§ÛŒ Ø¢Ù…ÙˆØ²Ø´", style=HEADER_STYLE),
            
            html.Div([
                dash_table.DataTable(
                    columns=[
                        {'name': 'Ù¾Ø§Ø±Ø§Ù…ØªØ±', 'id': 'param'},
                        {'name': 'Ù…Ù‚Ø¯Ø§Ø±', 'id': 'value'},
                        {'name': 'ØªÙˆØ¶ÛŒØ­Ø§Øª', 'id': 'desc'}
                    ],
                    data=[
                        {'param': 'Learning Rate (Actor)', 'value': '0.0001', 
                         'desc': 'Ù†Ø±Ø® ÛŒØ§Ø¯Ú¯ÛŒØ±ÛŒ Ø´Ø¨Ú©Ù‡ Actor (Ú©Ù†Ø¯ Ø¨Ø±Ø§ÛŒ Ù¾Ø§ÛŒØ¯Ø§Ø±ÛŒ)'},
                        {'param': 'Learning Rate (Critic)', 'value': '0.001', 
                         'desc': 'Ù†Ø±Ø® ÛŒØ§Ø¯Ú¯ÛŒØ±ÛŒ Ø´Ø¨Ú©Ù‡ Critic (Ø³Ø±ÛŒØ¹â€ŒØªØ± Ø§Ø² Actor)'},
                        {'param': 'Gamma (Discount)', 'value': '0.95', 
                         'desc': 'Ø¶Ø±ÛŒØ¨ ØªØ®ÙÛŒÙ Ø¨Ø±Ø§ÛŒ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø§Ø±Ø²Ø´ Ø¢ÛŒÙ†Ø¯Ù‡'},
                        {'param': 'Tau (Soft Update)', 'value': '0.01', 
                         'desc': 'Ø¶Ø±ÛŒØ¨ Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù†Ø±Ù… Ø´Ø¨Ú©Ù‡â€ŒÙ‡Ø§ÛŒ Ù‡Ø¯Ù'},
                        {'param': 'Batch Size', 'value': '64', 
                         'desc': 'ØªØ¹Ø¯Ø§Ø¯ Ù†Ù…ÙˆÙ†Ù‡â€ŒÙ‡Ø§ Ø¯Ø± Ù‡Ø± Ù…Ø±Ø­Ù„Ù‡ Ø¢Ù…ÙˆØ²Ø´'},
                        {'param': 'Buffer Size', 'value': '100000', 
                         'desc': 'Ø¸Ø±ÙÛŒØª Replay Buffer Ø¨Ø±Ø§ÛŒ Ø°Ø®ÛŒØ±Ù‡ ØªØ¬Ø±Ø¨ÛŒØ§Øª'},
                        {'param': 'Max Episodes', 'value': '500', 
                         'desc': 'ØªØ¹Ø¯Ø§Ø¯ Ú©Ù„ Ø§Ù¾ÛŒØ²ÙˆØ¯Ù‡Ø§ÛŒ Ø¢Ù…ÙˆØ²Ø´'}
                    ],
                    style_cell={
                        'textAlign': 'right',
                        'padding': '15px',
                        'backgroundColor': '#1e2a38',
                        'color': '#e0e0e0',
                        'fontFamily': 'Vazir',
                        'border': '1px solid #2d3e50'
                    },
                    style_header={
                        'backgroundColor': '#00d4ff',
                        'color': '#0d1b2a',
                        'fontWeight': 'bold',
                        'textAlign': 'center',
                        'fontFamily': 'Vazir',
                        'fontSize': '16px'
                    },
                    style_data_conditional=[
                        {'if': {'row_index': 'odd'}, 'backgroundColor': '#253545'}
                    ]
                )
            ], style=CARD_STYLE),
            
            html.Div([
                html.H4("ğŸ“š ØªÙˆØ¶ÛŒØ­Ø§Øª ØªÚ©Ù…ÛŒÙ„ÛŒ", style={'color': '#00ff88', 'fontFamily': 'Vazir'}),
                html.P("ğŸ”¹ Ø§Ù„Ú¯ÙˆØ±ÛŒØªÙ… MADDPG ÛŒÚ© Ø±ÙˆØ´ ÛŒØ§Ø¯Ú¯ÛŒØ±ÛŒ ØªÙ‚ÙˆÛŒØªÛŒ Ø¹Ù…ÛŒÙ‚ Ø¨Ø±Ø§ÛŒ Ù…Ø­ÛŒØ·â€ŒÙ‡Ø§ÛŒ Ú†Ù†Ø¯ Ø¹Ø§Ù…Ù„Ù‡ Ø§Ø³Øª", 
                       style=TEXT_STYLE),
                html.P("ğŸ”¹ Ø§Ø² Experience Replay Ø¨Ø±Ø§ÛŒ Ø´Ú©Ø³ØªÙ† Ù‡Ù…Ø¨Ø³ØªÚ¯ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯", 
                       style=TEXT_STYLE),
                html.P("ğŸ”¹ Target Networks Ø¨Ø±Ø§ÛŒ Ù¾Ø§ÛŒØ¯Ø§Ø±ÛŒ Ø¢Ù…ÙˆØ²Ø´ Ø¨Ù‡ Ú©Ø§Ø± Ù…ÛŒâ€ŒØ±ÙˆÙ†Ø¯", 
                       style=TEXT_STYLE)
            ], style=CARD_STYLE)
        ])
    elif tab == 'tab-results':
        return html.Div([
            html.H3("ğŸ“ˆ Ù†ØªØ§ÛŒØ¬ Ø¢Ù…ÙˆØ²Ø´", style=HEADER_STYLE),
            
            html.Div([
                html.Button('ğŸ”„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù†ØªØ§ÛŒØ¬', id='load-button', n_clicks=0,
                           style={'padding': '12px 30px', 'fontSize': '16px', 
                                  'backgroundColor': '#00d4ff', 'color': '#0d1b2a',
                                  'border': 'none', 'borderRadius': '8px', 
                                  'cursor': 'pointer', 'fontWeight': 'bold',
                                  'fontFamily': 'Vazir', 'marginBottom': '20px'}),
                html.Div(id='results-output')
            ])
        ])
    
    elif tab == 'tab-live':
        return html.Div([
            html.H3("ğŸ”´ Ù…Ø§Ù†ÛŒØªÙˆØ±ÛŒÙ†Ú¯ Ø²Ù†Ø¯Ù‡", style=HEADER_STYLE),
            
            html.Div([
                html.Button('â–¶ï¸ Ø´Ø±ÙˆØ¹', id='start-button', n_clicks=0,
                           style={'padding': '12px 25px', 'fontSize': '16px',
                                  'backgroundColor': '#00ff88', 'color': '#0d1b2a',
                                  'border': 'none', 'borderRadius': '8px',
                                  'cursor': 'pointer', 'fontWeight': 'bold',
                                  'fontFamily': 'Vazir', 'marginRight': '10px'}),
                html.Button('â¸ï¸ ØªÙˆÙ‚Ù', id='pause-button', n_clicks=0,
                           style={'padding': '12px 25px', 'fontSize': '16px',
                                  'backgroundColor': '#ff9500', 'color': '#0d1b2a',
                                  'border': 'none', 'borderRadius': '8px',
                                  'cursor': 'pointer', 'fontWeight': 'bold',
                                  'fontFamily': 'Vazir'}),
                html.Div(id='live-status', style={'marginTop': '15px', 'fontSize': '18px',
                                                   'color': '#00d4ff', 'fontFamily': 'Vazir'})
            ], style={'marginBottom': '25px'}),
            
            dcc.Interval(id='interval-component', interval=2000, n_intervals=0, disabled=True),
            
            html.Div([
                html.Div([
                    dcc.Graph(id='live-utility-graph', 
                             config={'displayModeBar': False},
                             style={'height': '350px'})
                ], style=CARD_STYLE),
                
                html.Div([
                    dcc.Graph(id='live-energy-graph',
                             config={'displayModeBar': False},
                             style={'height': '350px'})
                ], style=CARD_STYLE)
            ])
        ])

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# Callback: Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù†ØªØ§ÛŒØ¬ Ø¢Ù…ÙˆØ²Ø´
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
@app.callback(
    Output('results-output', 'children'),
    Input('load-button', 'n_clicks')
)
def load_results(n_clicks):
    """Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ùˆ Ù†Ù…Ø§ÛŒØ´ Ù†ØªØ§ÛŒØ¬ Ø¢Ù…ÙˆØ²Ø´"""
    if n_clicks == 0:
        raise PreventUpdate
    
    results_file = os.path.join(RESULTS_DIR, 'sample_training_results.npy')
    
    if not os.path.exists(results_file):
        return html.Div("âš ï¸ ÙØ§ÛŒÙ„ Ù†ØªØ§ÛŒØ¬ ÛŒØ§ÙØª Ù†Ø´Ø¯!", 
                       style={'color': '#ff4444', 'fontSize': '18px', 'fontFamily': 'Vazir'})
    
    try:
        data = np.load(results_file, allow_pickle=True).item()
        episodes = data['episodes']
        rewards = data['rewards']
        utilities = data['utilities']
        energies = data['energies']
        
        # Ù†Ù…ÙˆØ¯Ø§Ø± Ù¾Ø§Ø¯Ø§Ø´
        reward_fig = go.Figure()
        reward_fig.add_trace(go.Scatter(
            x=episodes, y=rewards,
            mode='lines',
            name='Reward',
            line=dict(color='#00d4ff', width=2),
            fill='tozeroy',
            fillcolor='rgba(0, 212, 255, 0.2)'
        ))
        reward_fig.update_layout(
            title='Ø±ÙˆÙ†Ø¯ Ù¾Ø§Ø¯Ø§Ø´ Ø¯Ø± Ø·ÙˆÙ„ Ø¢Ù…ÙˆØ²Ø´',
            xaxis_title='Ø§Ù¾ÛŒØ²ÙˆØ¯',
            yaxis_title='Ù¾Ø§Ø¯Ø§Ø´',
            template='plotly_dark',
            plot_bgcolor='#1e2a38',
            paper_bgcolor='#1e2a38',
            font=dict(family='Vazir', color='#e0e0e0'),
            hovermode='x unified',
            xaxis=dict(gridcolor='#2d3e50'),
            yaxis=dict(gridcolor='#2d3e50')
        )
        
        # Ù†Ù…ÙˆØ¯Ø§Ø± Ú©Ø§Ø±Ø§ÛŒÛŒ
        utility_fig = go.Figure()
        utility_fig.add_trace(go.Scatter(
            x=episodes, y=utilities,
            mode='lines+markers',
            name='Utility',
            line=dict(color='#00ff88', width=2),
            marker=dict(size=4)
        ))
        utility_fig.update_layout(
            title='Ú©Ø§Ø±Ø§ÛŒÛŒ Ø³ÛŒØ³ØªÙ…',
            xaxis_title='Ø§Ù¾ÛŒØ²ÙˆØ¯',
            yaxis_title='Ú©Ø§Ø±Ø§ÛŒÛŒ (0-1)',
            template='plotly_dark',
            plot_bgcolor='#1e2a38',
            paper_bgcolor='#1e2a38',
            font=dict(family='Vazir', color='#e0e0e0'),
            hovermode='x unified',
            xaxis=dict(gridcolor='#2d3e50'),
            yaxis=dict(gridcolor='#2d3e50', range=[0, 1])
        )
        
        # Ù†Ù…ÙˆØ¯Ø§Ø± Ø§Ù†Ø±Ú˜ÛŒ
        energy_fig = go.Figure()
        energy_fig.add_trace(go.Scatter(
            x=episodes, y=energies,
            mode='lines',
            name='Energy',
            line=dict(color='#ff9500', width=2),
            fill='tozeroy',
            fillcolor='rgba(255, 149, 0, 0.2)'
        ))
        energy_fig.update_layout(
            title='Ù…ØµØ±Ù Ø§Ù†Ø±Ú˜ÛŒ',
            xaxis_title='Ø§Ù¾ÛŒØ²ÙˆØ¯',
            yaxis_title='Ø§Ù†Ø±Ú˜ÛŒ (ÙˆØ§Ø­Ø¯)',
            template='plotly_dark',
            plot_bgcolor='#1e2a38',
            paper_bgcolor='#1e2a38',
            font=dict(family='Vazir', color='#e0e0e0'),
            hovermode='x unified',
            xaxis=dict(gridcolor='#2d3e50'),
            yaxis=dict(gridcolor='#2d3e50')
        )
        
        # Ø¢Ù…Ø§Ø± Ù†Ù‡Ø§ÛŒÛŒ
        final_stats = html.Div([
            html.H4("ğŸ“Š Ø¢Ù…Ø§Ø± Ù†Ù‡Ø§ÛŒÛŒ", style={'color': '#00d4ff', 'fontFamily': 'Vazir'}),
            html.P(f"ğŸ¯ Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† Ù¾Ø§Ø¯Ø§Ø´: {np.mean(rewards[-50:]):.2f}", style=TEXT_STYLE),
            html.P(f"âš¡ Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† Ú©Ø§Ø±Ø§ÛŒÛŒ: {np.mean(utilities[-50:]):.3f}", style=TEXT_STYLE),
            html.P(f"ğŸ”‹ Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† Ø§Ù†Ø±Ú˜ÛŒ: {np.mean(energies[-50:]):.2f}", style=TEXT_STYLE),
            html.P(f"ğŸ“ˆ Ø¨Ù‡Ø¨ÙˆØ¯ Ù¾Ø§Ø¯Ø§Ø´: {((rewards[-1] - rewards[0]) / abs(rewards[0]) * 100):.1f}%", 
                   style=TEXT_STYLE)
        ], style=CARD_STYLE)
        
        return html.Div([
            html.Div([dcc.Graph(figure=reward_fig)], style=CARD_STYLE),
            html.Div([dcc.Graph(figure=utility_fig)], style=CARD_STYLE),
            html.Div([dcc.Graph(figure=energy_fig)], style=CARD_STYLE),
            final_stats
        ])
        
    except Exception as e:
        return html.Div(f"âŒ Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ: {str(e)}", 
                       style={'color': '#ff4444', 'fontSize': '16px', 'fontFamily': 'Vazir'})

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# Callback: Ú©Ù†ØªØ±Ù„ Ù…Ø§Ù†ÛŒØªÙˆØ±ÛŒÙ†Ú¯ Ø²Ù†Ø¯Ù‡
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
@app.callback(
    [Output('interval-component', 'disabled'),
     Output('live-status', 'children')],
    [Input('start-button', 'n_clicks'),
     Input('pause-button', 'n_clicks')],
    prevent_initial_call=True
)
def control_monitoring(start_clicks, pause_clicks):
    """Ú©Ù†ØªØ±Ù„ Ø´Ø±ÙˆØ¹/ØªÙˆÙ‚Ù Ù…Ø§Ù†ÛŒØªÙˆØ±ÛŒÙ†Ú¯"""
    ctx = dash.callback_context
    if not ctx.triggered:
        raise PreventUpdate
    
    button_id = ctx.triggered[0]['prop_id'].split('.')[0]
    
    if button_id == 'start-button':
        return False, "âœ… Ù…Ø§Ù†ÛŒØªÙˆØ±ÛŒÙ†Ú¯ ÙØ¹Ø§Ù„ Ø§Ø³Øª..."
    else:
        return True, "â¸ï¸ Ù…Ø§Ù†ÛŒØªÙˆØ±ÛŒÙ†Ú¯ Ù…ØªÙˆÙ‚Ù Ø´Ø¯"

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# Callback: Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù†Ù…ÙˆØ¯Ø§Ø±Ù‡Ø§ÛŒ Ø²Ù†Ø¯Ù‡
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
@app.callback(
    [Output('live-utility-graph', 'figure'),
     Output('live-energy-graph', 'figure')],
    Input('interval-component', 'n_intervals')
)
def update_live_graphs(n):
    """Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù†Ù…ÙˆØ¯Ø§Ø±Ù‡Ø§ÛŒ Ø²Ù†Ø¯Ù‡"""
    global episode_counter, live_data_store
    
    episode_counter += 1
    new_utility = np.clip(0.5 + 0.3 * np.sin(episode_counter / 5) + np.random.normal(0, 0.05), 0, 1)
    new_energy = np.clip(50 + 20 * np.cos(episode_counter / 7) + np.random.normal(0, 3), 10, 100)
    
    live_data_store['episodes'].append(episode_counter)
    live_data_store['utility'].append(new_utility)
    live_data_store['energy'].append(new_energy)
    
    # Ù†Ù…ÙˆØ¯Ø§Ø± Ú©Ø§Ø±Ø§ÛŒÛŒ Ø²Ù†Ø¯Ù‡
    utility_fig = go.Figure()
    utility_fig.add_trace(go.Scatter(
        x=list(live_data_store['episodes']),
        y=list(live_data_store['utility']),
        mode='lines+markers',
        name='Utility',
        line=dict(color='#00ff88', width=3),
        marker=dict(size=6, color='#00ff88')
    ))
    utility_fig.update_layout(
        title='Ú©Ø§Ø±Ø§ÛŒÛŒ Ø²Ù†Ø¯Ù‡',
        xaxis_title='Ù‚Ø¯Ù…',
        yaxis_title='Ú©Ø§Ø±Ø§ÛŒÛŒ',
        template='plotly_dark',
        plot_bgcolor='#1e2a38',
        paper_bgcolor='#1e2a38',
        font=dict(family='Vazir', color='#e0e0e0'),
        xaxis=dict(gridcolor='#2d3e50', range=[max(1, episode_counter - 30), episode_counter]),
        yaxis=dict(gridcolor='#2d3e50', range=[0, 1])
    )
    
    # Ù†Ù…ÙˆØ¯Ø§Ø± Ø§Ù†Ø±Ú˜ÛŒ Ø²Ù†Ø¯Ù‡
    energy_fig = go.Figure()
    energy_fig.add_trace(go.Scatter(
        x=list(live_data_store['episodes']),
        y=list(live_data_store['energy']),
        mode='lines+markers',
        name='Energy',
        line=dict(color='#ff9500', width=3),
        marker=dict(size=6, color='#ff9500')
    ))
    energy_fig.update_layout(
        title='Ù…ØµØ±Ù Ø§Ù†Ø±Ú˜ÛŒ Ø²Ù†Ø¯Ù‡',
        xaxis_title='Ù‚Ø¯Ù…',
        yaxis_title='Ø§Ù†Ø±Ú˜ÛŒ',
        template='plotly_dark',
        plot_bgcolor='#1e2a38',
        paper_bgcolor='#1e2a38',
        font=dict(family='Vazir', color='#e0e0e0'),
        xaxis=dict(gridcolor='#2d3e50', range=[max(1, episode_counter - 30), episode_counter]),
        yaxis=dict(gridcolor='#2d3e50')
    )
    
    return utility_fig, energy_fig

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# Ø§Ø¬Ø±Ø§ÛŒ Ø¨Ø±Ù†Ø§Ù…Ù‡
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
if __name__ == '__main__':
    print("\n" + "="*70)
    print("ğŸš€ Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ SkyMind Ø¯Ø± Ø­Ø§Ù„ Ø§Ø¬Ø±Ø§...")
    print("ğŸŒ Ø¢Ø¯Ø±Ø³: http://127.0.0.1:8050")
    print("="*70 + "\n")
    app.run_server(debug=True, host='127.0.0.1', port=8050)

